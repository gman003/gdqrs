<!DOCTYPE html>
<html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Games Done Quick: Reviewed Slow</title>
<style>
* {
	box-sizing: border-box;
}

@font-face {
	font-family: gdqpixel;
	src: url('fonts/gdqpixel.woff2') format('woff2');
	/* taken from https://github.com/GamesDoneQuick/gdq-break-channels/ */
	/* used under Apache v2 license (https://www.apache.org/licenses/LICENSE-2.0) */
}
@font-face {
	font-family: osd;
	src: url('fonts/UAV-OSD-Sans-Mono.ttf') format('truetype');
	/* by Nicholas Kruse (https://nicholaskruse.com) */
	/* Font is free to use for personal or commercial use. */
}
@font-face {
	font-family: Liberation Mono;
	src: url('fonts/LiberationMono-Regular.ttf') format('truetype');
	/* taken from https://github.com/liberationfonts/liberation-fonts */
	/* licensed under SIL Open Font License */
}

.agdq {
	--color-panel-bg:		#161A22;
	--color-panel-border:	#070D15;
	--color-panel-top:		#242B30;
	--color-panel-hover:	#1F3451;

	/* old stuff */
	--color-bg-h1:   #339999;
	--color-bg-h2:   #003232;
}
.sgdq {
	--color-panel-bg:		#131115;
	--color-panel-border:	#19161E;
	--color-panel-top:		#716C74;
	--color-panel-hover:	#4F1E36;

	/* old stuff */
	--color-bg-h1:   #e10189;
	--color-bg-h2:   #34002c;
}
.spec {
	--color-bg-h1:   #ffb900;
	--color-bg-h2:   #403200;
}

body {
	box-sizing: border-box;
	background: #000;
}

#runs {
	position: absolute;
	top: 0;
	left: 0;
	width: calc(100% - var(--player-width));
	height: 100%;
	overflow-y: scroll;
	scrollbar-width: thin;
	direction: rtl;
}

#runs gdq-run {
	direction: ltr;
}

#runs h1, #runs h2 {
	width: 100%;
	padding: 4px 24px;
	font-family: gdqpixel;
	font-size: var(--header-font-size);
	text-align: center;
	margin: 0 0 24px 0;
}

#runs h1 {
	background: #58E7D6;
	color: #000;
	font-weight: bold;
}
#runs h1 span {
	display: block;
	font-size: calc(var(--header-font-size)/2);
	font-weight: normal;
}
#runs h2 {
	background: #D9DD48;
	color: #000;
	position: sticky;
	bottom: 0;
	top: 0;
	cursor: pointer;
}
#runs::-webkit-scrollbar {
	width: 8px;
}
#runs::-webkit-scrollbar-thumb {
	background: #424242;
}

#main {
	position: absolute;
	top: 0;
	left: calc(100% - var(--player-width));
	width: var(--player-width);
	height: var(--player-height);
	background: black;
	color: white;
	text-align: center;
	--header-size: 32px;
}
#main div {
	width: 100%;
}
#main h1 {
	font-size: var(--header-size);
	font-weight: bold;
	font-family: gdqpixel, sans-serif;
	margin: 0;
	padding: calc(var(--header-size)/2) 0 var(--header-size) 0;
	
	border-width: 2px;
	border-style: solid;
	border-color: var(--color-panel-border);
	border-top-color: var(--color-panel-top);
	background: var(--color-panel-bg);
}
#main #player {
	width: 100%;
	height: 100%;
}
#main .container {
	height: calc(var(--player-height) - var(--header-size) * 3);
}
#main .container::-webkit-scrollbar {
	width: 8px;
}
#main .container::-webkit-scrollbar-thumb {
	background: #424242;
}

#footer {
	position: absolute;
	bottom: 0;
	left: calc(100% - var(--player-width));
	width: var(--player-width);
	height: calc(100% - var(--player-height));
	vertical-align: bottom;
	overflow: hidden;
	background: black;
}

#footer div {
	width: 100%;
	position: absolute;
}

#footer #navbar {
	top: 0;
	padding: 0 2px;
	display: flex;
	column-gap: 2px;
}
#footer #navbar a {
	flex: 1;
	border-width: 2px;
	border-style: solid;
	border-color: var(--color-panel-border);
	border-top-color: var(--color-panel-top);
	color: white;
	background: var(--color-panel-bg);
	padding: 9px 24px;
	font-size: 16px;
	font-family: osd;
	font-weight: bold;
	text-decoration: none;
	text-align: center;
	cursor: pointer;
}
#footer #navbar a:hover {
	background: var(--color-panel-hover);
}

#footer #details {
	top: 40px;
	height: calc(100% - 40px);
	margin: 2px;
	padding: 8px;
	
	border-width: 2px;
	border-style: solid;
	border-color: var(--color-panel-border);
	border-top-color: var(--color-panel-top);
	color: white;
	background: var(--color-panel-bg);
	
	font-family: Liberation Mono;
	font-size: 18px;
	line-height: 18px;
}
#footer #details p {
	margin-top: 0;
	margin-bottom: 12px;
}
#footer #details a {
	text-decoration: underline;
	cursor: pointer;
}

#raw {
	display: none;
}
#marathon-headers {
	display: none;
}
</style>
<style media="all and (orientation: landscape)">
@media (min-width: 2400px) {
	body {
		--player-width: 1920px;
		--player-height: 1080px;
	}
	#runs {
		--header-font-size: 24px;
		--detail-font-size: 18px;
	}
	#runs gdq-run {
		scroll-margin-top: calc(42px * 2 + 24px);
	}
	#main {
		--header-size: 48px;
	}
	#main #browser {
		--eventlist-size: 48px;
	}
	#main #info .container {
		columns: 3 auto;
	}
	#footer #navbar a {
		font-size: 18px;
	}
}
@media (min-width: 1600px) and (max-width: 2400px) {
	body {
		--player-width: 1280px;
		--player-height: 720px;
	}
	#runs {
		--header-font-size: 18px;
		--detail-font-size: 12px;
	}
	#runs gdq-run {
		scroll-margin-top: calc(34px * 2 + 24px);
	}
	#main {
		--header-size: 40px;
	}
	#main #browser {
		--eventlist-size: 40px;
	}
	#main #info .container {
		columns: 2 auto;
		overflow-y: scroll;
	}
	#footer #navbar a {
		font-size: 16px;
	}
}
@media (min-width: 1200px) and (max-width: 1600px) {
	body {
		--player-width: 854px;
		--player-height: 480px;
	}
	#runs {
		--header-font-size: 18px;
		--detail-font-size: 12px;
	}
	#runs gdq-run {
		scroll-margin-top: calc(34px * 2 + 24px);
	}
	#main {
		--header-size: 27px;
	}
	#main #browser {
		--eventlist-size: 27px;
	}
	#main #info .container {
		overflow-y: scroll;
	}
	#main #info .container div {
		height: auto;
	}
	#footer #navbar a {
		font-size: 14px;
	}
}
@media (max-width: 1200px) {
	body {
		--player-width: 640px;
		--player-height: 360px;
	}
	#runs {
		--header-font-size: 18px;
		--detail-font-size: 12px;
	}
	#runs gdq-run {
		scroll-margin-top: calc(34px * 2 + 24px);
	}
	#main {
		--header-size: 24px;
	}
	#main #browser {
		--eventlist-size: 20px;
	}
	#main #browser a {
		font-size: 18px !important;
	}
	#main #info .container {
		overflow-y: scroll;
	}
	#main #info .container div {
		height: auto;
	}
	#footer #content {
		column-gap: 2px;
	}
	#footer #navbar a {
		font-size: 12px;
	}
}
</style>
<style media="all and (orientation: portrait)">
#main {
	left: calc((100% - var(--player-width)) / 2);
}
#runs {
	position: absolute;
	top: calc(var(--player-height) + 36px);
	width: 100%;
	height: calc(100% - var(--player-height) - 36px);
}
#footer {
	width: 100%;
	height: 36px;
	top: var(--player-height);
	left: 0;
}
#footer div {
	height: 100%;
}

@media (min-width: 2560px){
	body {
		--player-width: 2560px;
		--player-height: 1440px;
	}
	#runs gdq-run {
		scroll-margin-top: calc(30px * 2 + 24px);
	}
	#main #browser {
		--eventlist-size: 48px;
	}
	#main #info .container {
		columns: 2 auto;
	}
	#footer #navbar a {
		font-size: 18px;
	}
}
@media (min-width: 1920px) and (max-width: 2560px){
	body {
		--player-width: 1920px;
		--player-height: 1080px;
	}
	#runs gdq-run {
		scroll-margin-top: calc(30px * 2 + 24px);
	}
	#main #browser {
		--eventlist-size: 48px;
	}
	#main #info .container {
		columns: 2 auto;
	}
	#footer #navbar a {
		font-size: 16px;
	}
}
@media (min-width: 1280px) and (max-width: 1920px){
	body {
		--player-width: 1280px;
		--player-height: 720px;
	}
	#runs gdq-run {
		scroll-margin-top: calc(30px * 2 + 24px);
	}
	#main #browser {
		--eventlist-size: 42px;
	}
	#main #info .container {
		columns: 2 auto;
	}
	#footer #navbar a {
		font-size: 14px;
	}
}
@media (min-width: 854px) and (max-width: 1280px){
	body {
		--player-width: 854px;
		--player-height: 480px;
	}
	#runs gdq-run {
		scroll-margin-top: calc(30px * 2 + 24px);
	}
	#main #browser {
		--eventlist-size: 30px;
	}
	#main #info .container {
		overflow-y: scroll;
	}
	#main #info .container div {
		height: auto;
	}
	#footer #navbar a {
		font-size: 14px;
	}
}
@media (max-width: 854px) {
	body {
		--player-width: 640px;
		--player-height: 360px;
	}
	#runs gdq-run {
		scroll-margin-top: calc(30px * 2 + 24px);
	}
	#main #browser {
		--eventlist-size: 20px;
	}
	#main #browser .container a {
		
	}
	#main #info .container {
		overflow-y: scroll;
	}
	#main #info .container div {
		height: auto;
	}
	#footer #navbar a {
		font-size: 12px;
	}
}
</style>
<body class="sgdq">
<template id="gdq-run">
	<style>
		* {
			box-sizing: border-box;
		}
		
		/* variant styles */
		
		:host(.agdq) {
			--color-header-title:	#fff;
			--color-header-desc:	#65662f; /* was an old value, check this */
			--color-header-bg1:		#12273D;
			--color-header-bg2:		#1F3451;
			--color-box-text:		#fff;
			--color-box-stars:		#FEDB08;
			--color-box-bg:			#161A22;
		}
		:host(.sgdq) {
			--color-header-title:	#fff;
			--color-header-desc:	#65662f; /* was an old value, check this */
			--color-header-bg1:		#3A1126;
			--color-header-bg2:		#4F1E36;
			--color-box-text:		#fff;
			--color-box-stars:		#FEDB08; /* not an actual GDQ color? */
			--color-box-bg:			#131115;
		}
		
		:host([rating="5"]) .run-title {
			background:
				linear-gradient(var(--color-header-bg1), color-mix(in srgb, var(--color-header-bg2) 75%, transparent)),
				repeating-linear-gradient(45deg, red, green, blue, red 100px);
		}
		
		:host(.awful_block) {
			--color-header-bg1:		#c00177;
			--color-header-bg2:		#c00177;
			--color-header-title:	#1fff77;
			--color-header-desc:	#1fff77;
			--color-box-bg:			#660133;
		}
		
		:host(.awful_block) .title-main {
			font-family: "Comic Sans MS", sans;
			font-size: 24px;
		}
		
		/* actual functional style stuff */
		
		.run {
			width: 100%;
			color: var(--color-box-text);
			background: var(--color-box-bg);
			margin-bottom: 16px;
			padding-bottom: 16px;
			cursor: pointer;
		}
		.run-title {
			font-family: osd;
			width: 100%;
			color: var(--color-header-title);
			background: linear-gradient(var(--color-header-bg1), var(--color-header-bg2));
			padding: 4px 16px;
			display: flex;
			vertical-align: bottom;
		}
		.title-main {
			font-size: 16px;
			font-weight: bold;
			min-height: 28px;
			line-height: 28px;
			display: inline-block;
			margin-left: 0px;
			flex: auto;
			vertical-align: bottom;
		}
		.title-details {
			font-size: 12px;
			min-height: 28px;
			line-height: 28px;
			color: var(--color-header-desc);
			display: inline-block;
			margin-right: 0px;
			flex: auto;
			text-align: right;
			vertical-align: bottom;
		}
		.run-item {
			font-family: Liberation Mono;
			font-size: 18px;
			line-height: 28px;
			margin: 0 16px;
		}
		.score-header {
			display: inline-block;
			width: 20%;
		}
		.score-stars {
			display: inline-block;
			width: 80%;
			color: var(--color-box-stars);
		}
		abbr {
			cursor: help;
		}
	</style>

	<div class="run">
		<div class="run-title">
			<span class="title-main"><slot name="game">GAME</slot></span>
			<span class="title-details">(<slot name="plat">PLATFORM</slot> - <slot name="dev">DEVELOPER</slot> <slot name="year">YEAR</slot>)</span>
		</div>
		<div class="run-item"><slot name="category">CATEGORY</slot></div>
		<div class="run-item"><slot name="runner">by RUNNER</slot></div>
		<div class="run-item"><slot name="crew">host HOST, couch PEOPLE</slot></div>
		<div class="run-item"><slot name="time">MMmSSs</slot> (<slot name="estimate">est MMm</slot>, <slot name="wr">wr MMmSSs</slot>) <slot name="time-tags">[TAGS]</slot></div>
		<div class="run-item"><div class="score-header">Overall</div><div class="score-stars"><slot name="overall">☆☆☆☆☆</slot></div></div>
		<div class="run-item"><div class="score-header">Skill</div><div class="score-stars"><slot name="skill">☆☆☆☆☆</slot></div></div>
		<div class="run-item"><div class="score-header">Fun</div><div class="score-stars"><slot name="fun">☆☆☆☆☆</slot></div></div>
		<div class="run-item">Review: <slot name="review">(Not Yet Reviewed)</slot></div>
	</div>
</template>
<div id="marathon-headers"></div>

<div id="runs"></div>

<div id="main">
	<div id="browser">
		<h1>Select Marathon</h1>
		<div class="container">
			<a                                                                    >...<span>Coming Eventually</span></a>
			<a class="sgdq" href="sgdq2018.txt" onclick="loadMarathon('sgdq2018')">SGDQ 2018<span>(99% - 156/157)</span></a>
			<a class="agdq" href="agdq2019.txt" onclick="loadMarathon('agdq2019')">AGDQ 2019<span>(99% - 139/140)</span></a>
			<a class="sgdq" href="sgdq2019.txt" onclick="loadMarathon('sgdq2019')">SGDQ 2019<span>(99% - 147/148)</span></a>
			<a class="agdq" href="agdq2020.txt" onclick="loadMarathon('agdq2020')">AGDQ 2020<span>(100% - 146/146)</span></a>
			<a class="sgdq" href="sgdq2020.txt" onclick="loadMarathon('sgdq2020')">SGDQ 2020<span>(99% - 149/150)</span></a>
			<a class="agdq" href="agdq2021.txt" onclick="loadMarathon('agdq2021')">AGDQ 2021<span>(100% - 151/151)</span></a>
			<a class="sgdq" href="sgdq2021.txt" onclick="loadMarathon('sgdq2021')">SGDQ 2021<span>(100% - 150/150)</span></a>
			<a class="agdq" href="agdq2022.txt" onclick="loadMarathon('agdq2022')">AGDQ 2022<span>(100% - 150/150)</span></a>
			<a class="sgdq" href="sgdq2022.txt" onclick="loadMarathon('sgdq2022')">SGDQ 2022<span>(98% - 124/126)</span></a>
			<a class="agdq" href="agdq2023.txt" onclick="loadMarathon('agdq2023')">AGDQ 2023<span>(100% - 151/151)</span></a>
			<a class="sgdq" href="sgdq2023.txt" onclick="loadMarathon('sgdq2023')">SGDQ 2023<span>(99% - 137/138)</span></a>
			<a class="agdq" href="agdq2024.txt" onclick="loadMarathon('agdq2024')">AGDQ 2024<span>(100% - 141/141)</span></a>
			<a class="sgdq" href="sgdq2024.txt" onclick="loadMarathon('sgdq2024')">SGDQ 2024<span>(99% - 150/152)</span></a>
			<a class="agdq" href="agdq2025.txt" onclick="loadMarathon('agdq2025')">AGDQ 2025<span>(97% - 144/148)</span></a>
			<a class="spec"                     onclick="loadMarathon('everything')">Everything<span>(past 7 years)</span></a>
		</div>
		<script>
			function loadMarathon(marathon, reset = true){
				var title = marathon.substring(0, 4).toUpperCase() + ' ' + marathon.substring(4);
				
				// set global style
				if (marathon.startsWith('a')){
					document.body.className = "agdq";
				} else {
					document.body.className = "sgdq";
				}
				
				if (reset){
					// scroll back to top and clear day link, unless this is an initial page load
					window.location.hash = "";
					document.getElementById("runs").scrollTo(0,0);
				}
				
				hideAllContentBut('player');
				clearMarathons();
				document.getElementById("marathon-headers").replaceChildren();
				
				if (marathon == "everything"){
					Promise.all([
						fetch(`sgdq2018.txt`, { cache: 'reload' }).then(response => response.text()),
						fetch(`agdq2019.txt`, { cache: 'reload' }).then(response => response.text()),
						fetch(`sgdq2019.txt`, { cache: 'reload' }).then(response => response.text()),
						fetch(`agdq2020.txt`, { cache: 'reload' }).then(response => response.text()),
						fetch(`sgdq2020.txt`, { cache: 'reload' }).then(response => response.text()),
						fetch(`agdq2021.txt`, { cache: 'reload' }).then(response => response.text()),
						fetch(`sgdq2021.txt`, { cache: 'reload' }).then(response => response.text()),
						fetch(`agdq2022.txt`, { cache: 'reload' }).then(response => response.text()),
						fetch(`sgdq2022.txt`, { cache: 'reload' }).then(response => response.text()),
						fetch(`agdq2023.txt`, { cache: 'reload' }).then(response => response.text()),
						fetch(`sgdq2023.txt`, { cache: 'reload' }).then(response => response.text()),
						fetch(`agdq2024.txt`, { cache: 'reload' }).then(response => response.text()),
						fetch(`sgdq2024.txt`, { cache: 'reload' }).then(response => response.text()),
						fetch(`agdq2025.txt`, { cache: 'reload' }).then(response => response.text()),
					])
						.then(inputs => { var result = ""; for (input of inputs){ result += input + "\n\n"; } return result; })
						.then(loadReviews);
				} else {
					fetch(`${marathon}.txt`, { cache: 'reload' })
						.then(response => response.text())
						.then(loadReviews);
				}
				
				// set URL
				
				if (reset && window.location.protocol != "file:"){
					var url = new URL(window.location.origin + window.location.pathname); // clear that obnoxious #
				} else {
					var url = new URL(window.location);
				}
				url.searchParams.set('m', marathon);
				window.history.pushState({"html":document.body.innerHTML},title, url);
			}
		</script>
		<style>
			#main #browser .container {
				--baseline-color-panel-border: var(--color-panel-border);
				--baseline-color-panel-top: var(--color-panel-top);
				--baseline-color-panel-bg: var(--color-panel-bg);
				--baseline-color-panel-hover: var(--color-panel-hover);
				--eventlist-button-width: calc(var(--eventlist-size) * 21 / 3);
				--eventlist-button-height: calc(var(--eventlist-size) * 5 / 2);
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(var(--eventlist-button-width), 1fr));
				column-gap: 2px;
				row-gap: 2px;
			}
			#main #browser a {
				font-size: calc(var(--eventlist-size)*2/3);
				font-weight: bold;
				font-family: osd, sans-serif;
				text-align: center;
				width: 100%;
				height: 100%;
				cursor: pointer;
				
				flex: 1;
				border-width: 2px;
				border-style: solid;
				border-color: var(--baseline-color-panel-border);
				border-top-color: var(--baseline-color-panel-top);
				background: var(--baseline-color-panel-bg);
				padding: calc(30% - var(--eventlist-size)) 24px 0 24px;
				text-decoration: none;
			}
			#main #browser a:hover {
				background: var(--baseline-color-panel-hover);
			}
			#main #browser a.agdq {
				color: #339999;
			}
			#main #browser a.sgdq {
				color: #e10189;
			}
			#main #browser a.spec {
				color: #ffb900;
			}
			#main #browser a span {
				display: block;
				font-size: calc(var(--eventlist-size)/3);
				font-weight: normal;
				padding-top: 8px;
				color: #fff;
			}
		</style>
	</div>
	<div id="player" hidden="true">Youtube Player - If you see this, either you've disabled Javascript, or Youtube's messed up.</div>
	<div id="filters" hidden="true">
		<h1>Filters &amp; Sorting</h1>
		<div class="container">
			<div>
				<h3>Sort</h3>
				<label><input type="radio" name="sort" value="when" checked />Chronologically</label>
				<label><input type="radio" name="sort" value="game" />By Game Title</label>
				<label><input type="radio" name="sort" value="rating" />By Rating</label>
				<label><input type="radio" name="sort" value="platform" />By Platform</label>
				<label><input type="radio" name="sort" value="duration" />By Length</label>
				<label><input type="checkbox" name="sort-reverse" />Reverse Sort</label>
			</div>
			<div>
				<h3>Filter By Ratings</h3>
				<label><input type="checkbox" name="rating" checked rating="N"/>Not Rated</label>
				<label><input type="checkbox" name="rating" checked rating="0"/>☆☆☆☆☆</label>
				<label><input type="checkbox" name="rating" checked rating="1"/>★☆☆☆☆</label>
				<label><input type="checkbox" name="rating" checked rating="2"/>★★☆☆☆</label>
				<label><input type="checkbox" name="rating" checked rating="3"/>★★★☆☆</label>
				<label><input type="checkbox" name="rating" checked rating="4"/>★★★★☆</label>
				<label><input type="checkbox" name="rating" checked rating="5"/>★★★★★</label>
				<label><input type="checkbox" name="rating" checked rating="S"/>Special</label>
			</div>
			<div>
				<h3>Filter By People</h3>
				<label><input type="text" name="runner" placeholder="(eg. TheMexicanRunner)" />Runner(s)</label>
				<label><input type="text" name="crew" placeholder="(eg. SpikeVegeta)" />Couch &amp; Crew</label>
				<label><input type="checkbox" name="proximity" checked value="inperson"/>In-Person</label>
				<label><input type="checkbox" name="proximity" checked value="remote"/>Remote</label>
				
				<p>Tip: Search "[WRH]" to find only runs by world record holders, or "race" to find competitive races.</p>
			</div>
			<div>
				<h3>Filter By Game</h3>
				<label><input type="text" name="game" placeholder="(eg. Zelda)" />Game Title</label>
				<label><input type="text" name="category" placeholder="(eg. Any%)" />Run Category</label>
				<label><input type="text" name="platform" placeholder="(eg. NES)" />Platform</label>
				<label><input type="text" name="developer" placeholder="(eg. Capcom)" />Developer</label>
			</div>
			<div>
				<h3>Filter By Duration</h3>
				<label><input type="checkbox" name="duration" checked min="0" max="10"/>Tiny (&lt;10 min)</label>
				<label><input type="checkbox" name="duration" checked min="10" max="30"/>Short (10-30 min)</label>
				<label><input type="checkbox" name="duration" checked min="30" max="60"/>Medium (30-60 min)</label>
				<label><input type="checkbox" name="duration" checked min="60" max="180"/>Long (1-3 hours)</label>
				<label><input type="checkbox" name="duration" checked min="180" max="999"/>Epic (&gt;3 hours)</label>
				<p>Or Enter Custom Range:</p>
				<label><input type="text" name="duration-min" placeholder="(eg. 5)" />Minimum (in minutes)</label>
				<label><input type="text" name="duration-max" placeholder="(eg. 300)" />Maximum (also in minutes)</label>
			</div>
			<div>
				<h3>Misc Filters</h3>
				<label><input type="text" name="block" placeholder="Awful" />Named Blocks</label>
				<label><input type="checkbox" name="duration-wr" checked"/>Only World Records</label>
			</div>
		</div>
		<style>
			#filters .container {
				columns: 3 auto;
				gap: 8px;
				overflow-y: scroll;
			}
			#filters .container div {
				display: inline-block;
				margin-bottom: 24px;
			}
			#filters h3 {
				width: 100%;
				background: #D9DD48;
				color: #000;
				padding: 4px 24px;
				font-family: gdqpixel;
				font-size: var(--header-font-size);
				text-align: center;
				margin: 0 0 8px 0;
			}
			#filters label, #filters p {
				display: block;
				text-align: left;
				font-family: Liberation Mono;
				margin-bottom: 0;
			}
			#filters input {
				margin: 8px 8px 8px 24px;
				background-color: black;
				color: white;
				padding: 4px;
			}
			#filters input[name^=duration][type=text] {
				width: 75px;
			}
		</style>
	</div>
	<div id="info" hidden="true">
		<h1>Information</h1>
		<div class="container">
			<div>
				<h3>Timing</h3>
				<p>Run times given are RTA/with loads. When possible, WR is given as RTA/with loads, even when rankings are determined IGT/loadless - so the IGT-based record holder is maintained, but I list the WR's RTA timing, for easiest comparison to the run length. Exceptions to this standard (eg. where the leaderboards do not list RTA timings) are noted.</p>
				<p>Run times generally follow the on-screen timer, except when that is significantly mistimed. Exhibition and showcase runs generally give a rough time, as they have no record to compare to.</p>
				<p>Leaderboards are generally checked a few days before the event begins, so last-minute record snags may be missed.</p>
			</div>
			<div>
				<h3>Ratings Guide</h3>
				<p>I am in the habit of using the full range of ratings, which may seem harsh to those used to seeing nothing lower than a 7/10. For reference, I expect to give only a few five-star ratings in each event, and even a single-star run is worth watching if it's a game or runner you particularly enjoy.</p>
				<table>
				<tr><th>☆☆☆☆☆</th><td>Don't bother watching</td></tr>
				<tr><th>★☆☆☆☆</th><td>A weak run, but still fun for fans of the game</td></tr>
				<tr><th>★★☆☆☆</th><td>A solid but unremarkable run, or a flawed gem</td></tr>
				<tr><th>★★★☆☆</th><td>A good run, but not a must-watch</td></tr>
				<tr><th>★★★★☆</th><td>A great run, probably a highlight of the marathon</td></tr>
				<tr><th>★★★★★</th><td>One of the best runs of all time</td></tr>
				</table>
			</div>
			<div>
				<h3>Corrections &amp; Contributions</h3>
				<p>If any information is factually incorrect (eg. wrong developer name, misspelled couch member), please feel free to <a href="https://github.com/gman003/gdqrs/issues">file a bug on the GitHub page</a>.</p>
				<p>If you wish to contribute to this project, <a href="https://github.com/gman003/gdqrs">check out the GitHub</a>. While I do not accept outside reviews, I'm more than happy to include fixes or improvements.</p>
			</div>
			<div>
				<h3>Legal Blurb</h3>
				<p>Games Done Quick: Reviewed Slow is by GMan003. The above reviews are my personal and subjective opinion.</p>
				<p>Games Done Quick and Awesome Games Done Quick are registered trademarks of Games Done Quick LLC, used here under nominative fair use. GDQ is an awesome event for good causes, and you should be watching it and giving them money.</p>
			</div>
		</div>
		<style>
			#main #info .container {
				gap: 8px;
			}
			#main #info .container div {
				display: inline-block;
			}
			#main #info .container div p {
				padding: 0 12px;
			}
			#main #info h3 {
				width: 100%;
				background: #D9DD48;
				color: #000;
				padding: 4px 24px;
				font-family: gdqpixel;
				font-size: var(--header-font-size);
				text-align: center;
				margin: 0 0 24px 0;
			}
			#main #info p, #main #info table {
				text-align: left;
				font-family: Liberation Mono;
				font-size: 18px;
				line-height: 28px;
			}

			#main #info table {
				width: 100%;
			}
			#main #info table th {
				color: #ffb900;
				padding: 4px;
			}
		</style>
	</div>
</div>

<div id="footer">
	<div id="navbar">
		<a onclick="hideAllContentBut('player')">Video</a>
		<a onclick="hideAllContentBut('filters')">Filters</a>
		<a onclick="hideAllContentBut('info')">About</a>
		<a onclick="hideAllContentBut('browser')">Marathons</a>
		<script>
			function hideAllContentBut(exception){
				console.log(`hiding all but ${exception}`);
				for (var element of ['browser', 'player', 'filters', 'info']){
					document.getElementById(element).hidden = element != exception;
				}
			}
		</script>
	</div>
	<div id="details">
	</div>
</div>

<script>
function createSlot(slot, content){
	var ret = document.createElement("span");
	ret.setAttribute("slot", slot);
	ret.innerHTML = content;
	return ret;
}
function defineTags(input){
	const tags = {
		// run tags
		'[WR]':		'New World Record!!!',
		'[PB]':		'New Personal Best!',
		'[NF]':		'Did Not Finish',
		'[NV]':		'Run Not Valid',
		'[WR?]':	'Possible World Record?',
		
		// runner tags
		'[WRH]':	'World Record Holder',
		'[2RH]':	'2nd Place Record Holder',
		'[3RH]':	'3rd Place Record Holder',
		'[ORH]':	'Only Record Holder',
		'[WRHs]':	'World Record Holders',
		'[2RHs]':	'2nd Place Record Holders',
		'[3RHs]':	'3rd Place Record Holders',
		'[ORHs]':	'Only Record Holders',
		'[REM]':	'Remote',
		
		// couch tags
		'[VA]':		'Voice Actor',
		'[DEV]':	'Game Developer',
		'[CM]':		'Community Manager',
	};
	for (var tag in tags){
		input = input.replaceAll(tag, '<abbr title="' + tags[tag] + '">' + tag + '</abbr>');
	}
	return input;
}
function definePlatforms(input){
	return input.split(/\s+/).map(function(w){
		const platforms = {
			'NES':		'Nintendo Entertainment System',
			'SNES': 	'Super Nintendo Entertainment System',
			'N64':		'Nintendo 64',
			'GC':		'Nintendo GameCube',
			'GB':		'Nintendo Game Boy',
			'GBC':		'Nintendo Game Boy Color',
			'GBA':		'Nintendo Game Boy Advance',
			'GBP':		'Nintendo Game Boy Player',
			'DS':		'Nintendo DS',
			'3DS':		'Nintendo 3DS',
			'VC': 		'Virtual Console',
			'PS1':		'Sony PlayStation 1',
			'PS2':		'Sony PlayStation 2',
			'PS3':		'Sony PlayStation 3',
			'PS4':		'Sony PlayStation 4',
			'PS5':		'Sony PlayStation 5',
			'PSP':		'Sony PlayStation Portable',
			'PSTV':		'Sony PlayStation TV',
			'XbC':		'Microsoft Xbox (the first one)',
			'Xb360':	'Microsoft Xbox 360 (the second one)',
			'Xb1':		'Microsoft Xbox One (the third one)',
			'XSX':		'Microsoft Xbox Series X (the fourth and newest one)',
			'PCE':		'NEC PC Engine/TurboGrafx-16',
			'TG16':		'NEC TurboGrafx-16/PC Engine',
		};
		return platforms.hasOwnProperty(w) ? '<abbr title="' + platforms[w] + '">' + w + '</abbr>' : w;
	}).join(' ');
}
function simplifyRatingString(input){
	const ratings = {
		'N/R':   'N',
		'☆☆☆☆☆': '0',
		'★☆☆☆☆': '1',
		'★★☆☆☆': '2',
		'★★★☆☆': '3',
		'★★★★☆': '4',
		'★★★★★': '5',
		'★☆★☆★': 'S',
		'☆★☆★☆': 'S',
	};
	
	return ratings[input] ?? 'N';
}
function simplifyTimeString(input){ // finds the longest duration (eg. 1h23m45s) in a string of times
	var to_return = 0;
	for (match of input.matchAll(/\~?(\dh)?(\d{1,2}m)?(\d{1,2}s)?/g)){
		var hours = match[1] === undefined ? 0 : parseInt(match[1].substring(0, match[1].length - 1), 10);
		var minutes = match[2] === undefined ? 0 : parseInt(match[2].substring(0, match[2].length - 1), 10);
		// TODO: count seconds and round?
		
		if (hours * 60 + minutes > to_return){ to_return = hours * 60 + minutes; }
	}
	return to_return;
}
function makeMarathonStringSortable(input){ // turns "SUMMER GAMES DONE QUICK 2021" to "2021 - SGDQ" etc
	const year = input.substring(input.length - 4);
	if (input.startsWith("SUMMER")){
		return year + " - SGDQ";
	} else {
		return year + " - AGDQ";
	}
}

function clearMarathons(){
	// clear out runs table
	document.getElementById("runs").replaceChildren();
}

function loadReviews(input){
	console.log("Loading reviews");
	var run_container = document.getElementById("runs");
	var marathon_header_container = document.getElementById("marathon-headers");
	
	var current_block = null, current_marathon = null, current_day = null, current_count = 0, current_header_count = 0;
	
	for (run of input.trim().split("\n\n")){
		var lines = run.split("\n");
		
		if (lines.length == 3 && lines[0].startsWith('===')){
			// looks like a starter header
			var name = lines[0].replaceAll('=', '');
			
			var header_element = document.createElement('h1');
			header_element.innerHTML = name + "<span>" + lines[1].replaceAll('=', '') + "</span><span>" + lines[2].replaceAll('=', '') + "</span>";
			header_element.setAttribute("data-marathon", makeMarathonStringSortable(name));
			if (name.startsWith("AWESOME")){
				header_element.classList.add("agdq");
			} else {
				header_element.classList.add("sgdq");
			}
			marathon_header_container.appendChild(header_element);
			
			current_marathon = makeMarathonStringSortable(name);
			
			continue;
		} else if (lines.length == 1 && lines[0].startsWith('---')){
			// looks like a section header
			var name = lines[0].replaceAll('-', '');
			
			var header2_element = document.createElement('h2');
			header2_element.innerHTML = header2_element.id = name;
			header2_element.setAttribute("data-header-number", current_header_count);
			header2_element.style = "top: " + (44 * current_header_count) + "px;"; // calc(100px + 66px * attr(--data-header-number integer));"
			run_container.appendChild(header2_element);
			
			current_day = name;
			current_header_count++;
			
			continue;
		} else if (lines.length == 1 && lines[0].startsWith('[[[')){
			// looks like a block header
			var block_re = lines[0].match(/\[\[\[(\/?)([A-Z ]+) BLOCK\]\]\]/);
			if (block_re[1] == "\/"){
				current_block = null;
			} else {
				current_block = block_re[2];
			}
			continue;
		}
		
		// for safety, ignore all other insufficiently-long runs
		if (lines.length < 10){
			console.log("Skipping entry: " + run);
			continue;
		}
		
		current_count++; // do this first, so it's one-indexed for the humans
		
		var run_element = document.createElement("gdq-run");
		run_element.className = document.body.className;
		
		var title_re = lines[0].match(/([^\(\)]+) \((.+) - ([^\(\)]+) ((YEAR)|[0-9,; ]+)\)/);
		var time_re = lines[4].match(/(~?[^\(\)]+) \(([A-Za-z0-9 ?]+), ([A-Za-z0-9% ,?-]+)\)([\[\] A-Z0-9?-]*)/);
		var youtube_re = lines[8].match(/Youtube ([A-Za-z0-9_-]+)\+?([0-9]*)/);
		
		if (title_re == null){
			console.log("Error parsing title: " + lines[0]);
			continue;
		}
		if (time_re == null){
			console.log("Error parsing time: " + lines[4]);
			continue;
		}
		if (youtube_re == null){
			console.log("Error parsing video link: " + lines[4]);
			continue;
		}
		
		var proximity = lines[2].includes("[REM]") ? "remote" : "inperson"; // TODO: add hybrid?
		if (current_marathon == "2020 - SGDQ"
			|| current_marathon == "2021 - AGDQ"
			|| current_marathon == "2021 - SGDQ"
			|| current_marathon == "2022 - AGDQ"
			|| current_marathon == "2023 - AGDQ"){
			proximity = "remote"; // all of them were online for these events
		}
		
		run_element.appendChild(createSlot("game", title_re[1]));
		run_element.appendChild(createSlot("plat", definePlatforms(title_re[2])));
		run_element.appendChild(createSlot("dev",  title_re[3]));
		run_element.appendChild(createSlot("year", title_re[4]));
		run_element.appendChild(createSlot("category", lines[1]));
		run_element.appendChild(createSlot("runner", defineTags(lines[2])));
		run_element.appendChild(createSlot("crew", defineTags(lines[3])));
		run_element.appendChild(createSlot("time", time_re[1]));
		run_element.appendChild(createSlot("estimate", time_re[2]));
		run_element.appendChild(createSlot("wr", time_re[3].replaceAll('igt', '<abbr title="In-Game Time">igt</abbr>')));
		run_element.appendChild(createSlot("time-tags", defineTags(time_re[4])));
		run_element.appendChild(createSlot("overall", lines[5].substring(8)));
		run_element.appendChild(createSlot("skill", lines[6].substring(8)));
		run_element.appendChild(createSlot("fun", lines[7].substring(8)));
		run_element.appendChild(createSlot("review", lines[9].substring(8)));
		
		run_element.setAttribute("marathon", current_marathon);
		run_element.setAttribute("day", current_day);
		run_element.setAttribute("count", current_count);
		run_element.setAttribute("yt-url", youtube_re[1]);
		run_element.setAttribute("yt-offset", youtube_re[2]);
		run_element.setAttribute("rating", simplifyRatingString(lines[5].substring(8)));
		run_element.setAttribute("duration", simplifyTimeString(time_re[1]));
		run_element.setAttribute("wr", lines[4].includes("[WR]"));
		run_element.setAttribute("game", title_re[1].toLowerCase());
		run_element.setAttribute("platform", title_re[2].toLowerCase());
		run_element.setAttribute("dev", title_re[3].toLowerCase());
		run_element.setAttribute("category", lines[1].toLowerCase());
		run_element.setAttribute("runner", lines[2].toLowerCase());
		run_element.setAttribute("crew", lines[3].toLowerCase());
		run_element.setAttribute("proximity", proximity);
		// TODO: NBs, NMs, etc?
		
		switch (current_block){
			case "AWFUL":
				run_element.classList.add("awful_block");
				break;
			case "SILLY":
				run_element.classList.add("silly_block");
				break;
			case "SPOOKY":
				run_element.classList.add("spooky_block");
				break;
			case "SONIC":
				run_element.classList.add("sonic_block");
				break;
			case "GENESIS":
				run_element.classList.add("genesis_block");
				break;
			case "CASTLEVANIA":
				run_element.classList.add("castlevania_block");
				break;
			case "MEGA MAN":
				run_element.classList.add("megaman_block");
				break;
			case "METROID":
				run_element.classList.add("metroid_block");
				break;
			case "MYST":
				run_element.classList.add("myst_block");
				break;
			case "REMOTE":
				run_element.classList.add("remote_block");
				break;
			case null: break;
			default:
				console.log("Unknown block: " + current_block);
				break;
		}
		
		run_container.appendChild(run_element);
	}

	for (element of document.getElementsByTagName("gdq-run")){
		element.onclick = function(ev){
			// set the current video
			console.log("Setting player to " + this.getAttribute("yt-url") + " +" + this.getAttribute("yt-offset"));
			if (player.getPlayerState() == 1){
				// currently playing, start instantly
				player.loadVideoById(this.getAttribute("yt-url"), this.getAttribute("yt-offset"));
			} else {
				// currently cued/paused/buffering/stopped, just cue it up
				player.cueVideoById(this.getAttribute("yt-url"), this.getAttribute("yt-offset"));
			}
			hideAllContentBut('player');
			
			function createLink(text, type){
				if (text.includes(" "))
					return '<a class="addsearch" term="'+type+':\''+text+'\'">' + text + '</a>';
				else
					return '<a class="addsearch" term="'+type+':'+text+'">' + text + '</a>';
			}
			
			// populate the description area
			var links = [];
			links.push(createLink(this.getAttribute("game"), "game"));
			
			// runners, separate logic for races vs solo/coop
			if (this.getAttribute("runner").startsWith("race") || this.getAttribute("runner").startsWith("relay race")){
				for (var runner of this.getAttribute("runner").split("vs")){
					if (runner.startsWith("relay ")){
						runner = runner.substring(6);
					}
					if (runner.startsWith("race, ")){
						runner = runner.substring(6);
					}
					if (runner.startsWith("race ")){
						runner = runner.substring(5);
					}
					if (runner.startsWith("Team ")){
						continue; // TODO: deal with THIS nonsense
					}
					runner = runner.replaceAll(/\[[A-Z0-9]+\]/gi, "");
					runner = runner.trim();
					
					links.push(createLink(runner, 'runner'));
				}
			} else {
				for (var runner of this.getAttribute("runner").split(",")){
					if (runner.startsWith("relay ")){
						runner = runner.substring(6);
					}
					if (runner.startsWith("coop ")){
						runner = runner.substring(5);
					}
					if (runner.startsWith("by ")){
						runner = runner.substring(3);
					}
					runner = runner.replaceAll(/\[[A-Z0-9]+\]/gi, "");
					runner = runner.trim();
					
					links.push(createLink(runner, 'runner'));
				}
			}
			
			// platforms
			for (var plat of this.getAttribute("platform").split(" via ")){
				links.push(createLink(plat, "plat"));
			}
			
			var details = document.getElementById("details");
			details.innerHTML = "";
			var title = details.appendChild(document.createElement("p"));
			title.appendChild(this.querySelector("span[slot=game]").firstChild.cloneNode(true));
			title.appendChild(document.createTextNode(" - "));
			title.appendChild(this.querySelector("span[slot=category]").firstChild.cloneNode(true));
			title.appendChild(document.createTextNode(" "));
			title.appendChild(this.querySelector("span[slot=runner]").firstChild.cloneNode(true));
			details.appendChild(document.createElement("p")).appendChild(this.querySelector("span[slot=review]").cloneNode(true));
			// details.appendChild(document.createElement("p")).innerHTML = "Find more: " + links.join(", ");
			
		}
	}
	
	refreshFilters();
}

function refreshFilters(){
	var sort_mode = "when";
	var allowedRatings = [];
	var allowedDurations = [];
	var allowedProximity = [];
	var durationMinimum = null;
	var durationMaximum = null;
	var requireWR = false;
	var allowedRunner = null;
	var allowedCrew = null;
	var allowedGame = null;
	var allowedCategory = null;
	var allowedPlatform = null;
	var allowedDev = null;
	var allowedBlock = null;
	
	sort_mode = document.querySelector("input[name=sort]:checked").value;

	for (element of document.querySelectorAll("input[rating]").values()){
		if (element.checked){
			allowedRatings.push(element.attributes.rating.value);
		}
	}
	for (element of document.querySelectorAll("input[name=duration]").values()){
		if (element.checked){
			allowedDurations.push([parseInt(element.attributes.min.value), parseInt(element.attributes.max.value)]);
		}
	}
	for (element of document.querySelectorAll("input[name=proximity]").values()){
		if (element.checked){
			allowedProximity.push(element.value);
		}
	}
	
	durationMinimum = document.getElementsByName("duration-min")[0].value;
	durationMaximum = document.getElementsByName("duration-max")[0].value;
	requireWR = document.getElementsByName("duration-wr")[0].checked;
	allowedRunner = document.getElementsByName("runner")[0].value.toLowerCase();
	allowedCrew = document.getElementsByName("crew")[0].value.toLowerCase();
	allowedGame = document.getElementsByName("game")[0].value.toLowerCase();
	allowedCategory = document.getElementsByName("category")[0].value.toLowerCase();
	allowedPlatform = document.getElementsByName("platform")[0].value.toLowerCase();
	allowedDev = document.getElementsByName("developer")[0].value.toLowerCase();
	allowedBlock = document.getElementsByName("block")[0].value.toLowerCase();

	// actually apply filters
	
	for (element of document.getElementsByTagName("gdq-run")){
		var passed = true;
		
		if (allowedRatings.length){
			passed = passed && allowedRatings.includes(element.attributes.rating.value);
		}
		if (allowedDurations.length){
			var subpassed = false;
			for (durations of allowedDurations){
				subpassed = subpassed || (parseInt(element.attributes.duration.value) > durations[0] && element.attributes.duration.value <= parseInt(durations[1]));
			}
			passed = passed && subpassed;
		}
		if (allowedProximity.length){
			passed = passed && allowedProximity.includes(element.attributes.proximity.value);
		}
		
		if (durationMinimum){
			passed = passed && parseInt(element.attributes.duration.value) >= parseInt(durationMinimum);
		}
		if (durationMaximum){
			passed = passed && parseInt(element.attributes.duration.value) <= parseInt(durationMaximum);
		}
		
		if (allowedRunner){
			passed = passed && element.attributes.runner.value.includes(allowedRunner);
		}
		if (allowedCrew){
			passed = passed && element.attributes.crew.value.includes(allowedCrew);
		}
		if (allowedGame){
			passed = passed && element.attributes.game.value.includes(allowedGame);
		}
		if (allowedCategory){
			passed = passed && element.attributes.category.value.includes(allowedCategory);
		}
		if (allowedPlatform){
			passed = passed && element.attributes.platform.value.includes(allowedPlatform);
		}
		if (allowedDev){
			passed = passed && element.attributes.dev.value.includes(allowedDev);
		}
		if (requireWR){
			passed = passed && element.attributes.wr.value == "true";
		}
		if (allowedBlock){
			passed = passed && element.classList.contains(allowedBlock + "_block");
		}
		
		element.hidden = !passed;
	}
	
	// sort
	refreshSort(sort_mode);
	
	// do another pass to hide section headers
	var section_has_content = false;
	for (element of Array.from(document.getElementById('runs').children).reverse()){
		if (element.tagName == "H2"){
			element.hidden = !section_has_content;
			section_has_content = false;
		} else if (element.tagName == "GDQ-RUN"){
			if (!element.hidden){ section_has_content = true; }
		}
	}
}

function refreshSort(mode){ // mode is one of: when game platform rating duration
	var multi_marathon = (document.getElementById("marathon-headers").childNodes.length > 1);
	if (mode == "when"){
		// figure out if we should be when-single (just one marathon) or when-all (every marathon loaded)
		if (multi_marathon){
			mode = "when-all";
		} else {
			mode = "when-single";
		}
	}
	
	var runs = [].slice.call(document.getElementsByTagName("gdq-run"));
	switch (mode){
		case "when-single":
		case "when-all":
			runs.sort(compareByWhen);
			break;
		case "game":
			runs.sort(compareByGame);
			break;
		case "platform":
			runs.sort(compareByPlatform);
			break;
		case "rating":
			runs.sort(compareByRating);
			break;
		case "duration":
			runs.sort(compareByDuration);
			break;
	}
	
	if (document.getElementsByName("sort-reverse")[0].checked){
		runs.reverse();
	}
	
	clearMarathons();
	
	var run_container = document.getElementById("runs");
	var current_marathon = null, current_category = null;
	
	if (!multi_marathon){
		run_container.appendChild(document.querySelector("#marathon-headers h1").cloneNode(true)); // there's only one, just grab it
	}
	
	for (run of runs){
		var run_marathon = run.getAttribute("marathon");
		if (mode == "when-all" && run_marathon != current_marathon){
			run_container.appendChild(document.querySelector("#marathon-headers h1[data-marathon='"+run_marathon+"']").cloneNode(true));
		}
		current_marathon = run_marathon;
		
		var run_category = getCategory(run, mode);
		if (run_category != current_category){
			// create a category header
			var header_element = document.createElement('h2');
			header_element.innerHTML = header_element.id = run_category;
			header_element.onclick = function(ev){
				var target = ev.target.nextSibling;
				while (target.hidden){
					target = target.nextSibling;
				}
				target.scrollIntoView({ behavior: "smooth" });
			}
	
			run_container.appendChild(header_element);
		}
		current_category = run_category;
	
		run_container.append(run);
	}
	
	var categories = document.querySelectorAll("#runs h2");
	var n = 0;
	for (category of categories){
		category.style = "top: 0px; z-index: " + (categories.length - n); // "top: " + (44 * n) + "px; bottom: " + (44 * (categories.length - n - 1)) + "px;";
		n++;
	}
	
	
	function getCategory(run, mode){
		switch (mode){
			case "game":
				return run.getAttribute("game").substring(0, 1).toUpperCase();
			case "platform":
				var plat = run.getAttribute("platform");
				if (plat.includes("via")){ plat = plat.substring(0, plat.indexOf("via")).trim(); }
				return plat.toUpperCase();
			case "when-all":
				return run.getAttribute("marathon");
			case "when-single":
				return run.getAttribute("day");
			case "rating":
				switch (run.getAttribute("rating")){
					case "N":
						return "(Unrated)";
					case "S":
						return "★☆★☆★";
					case "0":
						return "☆";
					default:
						return "★".repeat(run.getAttribute("rating"));// + "☆".repeat(5 - run.getAttribute("rating"));
				}
			case "duration":
				var duration = run.getAttribute("duration");
				     if (duration > 180){ return "Epic (>3 hours)"; }
				else if (duration > 60){ return "Long (1-3 hours)"; }
				else if (duration > 30){ return "Medium (30-60 minutes)"; }
				else if (duration > 10){ return "Short (10-30 minutes)"; }
				else                   { return "Tiny (<10 minutes)"; }
			default:
				return "unsorted";
		}
	}
	function compareString(a, b){
		if (a > b) return 1;
		if (a < b) return -1;
		return 0;
	}
	function compareNumber(a, b){
		if (parseInt(a) > parseInt(b)) return 1;
		if (parseInt(a) < parseInt(b)) return -1;
		return 0;
	}
	function compareByGame(a, b){
		return compareString(a.getAttribute("game"), b.getAttribute("game"));
	}
	function compareByPlatform(a, b){
		var a_plat = a.getAttribute("platform"), b_plat = b.getAttribute("platform");
		if (a_plat.includes("via")){ a_plat = a_plat.substring(0, a_plat.indexOf("via")).trim(); }
		if (b_plat.includes("via")){ b_plat = b_plat.substring(0, b_plat.indexOf("via")).trim(); }
		return compareString(a_plat, b_plat);
	}
	function compareByWhen(a, b){
		const sort1 = compareString(a.getAttribute("marathon"), b.getAttribute("marathon"));
		if (sort1 != 0) return sort1;
		return compareNumber(a.getAttribute("count"), b.getAttribute("count"));
	}
	function compareByRating(a, b){
		return compareNumber(integerizeRating(b.getAttribute("rating")), integerizeRating(a.getAttribute("rating"))); // deliberately inverted, so 5 sorts above 1
		
		function integerizeRating(rating){
			switch (rating){
				case "S": return 6;
				case "N": return -1;
				default: return rating;
			}
		}
	}
	function compareByDuration(a, b){
		return compareNumber(a.getAttribute("duration"), b.getAttribute("duration"));
	}
}

for (element of document.querySelectorAll("#browser .container a")){
	element.removeAttribute('href');
}
for (element of document.getElementsByTagName("input")){
	element.oninput = refreshFilters;
}

customElements.define('gdq-run',
	class extends HTMLElement {
		constructor() {
			super();
			let template = document.getElementById('gdq-run');
			let templateContent = template.content;
			
			const shadowRoot = this.attachShadow({mode: 'open'}).appendChild(templateContent.cloneNode(true));
		}
	}
);

document.getElementById("runs").onscrollend = function(ev){
	var n = 0;
	const l = document.querySelectorAll("#runs h2").length;
	var upperLimit = document.getElementById("runs").getBoundingClientRect().top + 40; // close enough to top of the screen
	var landscape = window.screen.availHeight < window.screen.availWidth;
	for (element of document.querySelectorAll("#runs h2")){
		if (element.getBoundingClientRect().top < upperLimit){ // sticking to top
			element.style = "z-index: " + n;
		} else {
			// sticking to bottom, or in the middle
			element.style = "z-index: " + (l - n);
		}
		n++;
	}
}

// load a Youtube player
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
var player;
function onYouTubeIframeAPIReady() {
	player = new YT.Player('player', {
		height: getComputedStyle(document.getElementById("player")).getPropertyValue("--player-height").replace('px', ''),
		width: getComputedStyle(document.getElementById("player")).getPropertyValue("--player-width").replace('px', ''),
		videoId: '',
		playerVars: {
			'playsinline': 1
		},
		events: {}
	});
	if (!document.getElementById("browser").hidden || !document.getElementById("filters").hidden || !document.getElementById("info").hidden){
		document.getElementById("player").hidden = true;
	}
}

// check URL params, see if we should shortcut into a marathon
let params = new URLSearchParams(document.location.search);
let marathon = params.get("m");
if (marathon != null){
	loadMarathon(marathon, false);
} else {
	hideAllContentBut('browser');
}
</script>
</body>
</html>